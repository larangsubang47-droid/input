<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#00897b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Laporan Kualitas Air - Jasa Tirta Luhur</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
  
  <style>
    /* âœ… BARU: Style untuk validasi dan sync */
    .input-error {
      border: 2px solid #f44336 !important;
      background-color: #ffebee !important;
    }
    
    #syncNotification {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      background: #ff9800;
      color: white;
      padding: 15px 20px;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      display: none;
    }
    
    #validationStatus {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 2px solid #e0e0e0;
    }
    
    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
      border-radius: 4px;
      border: none;
      background: white;
      color: #ff9800;
      font-weight: bold;
      cursor: pointer;
    }
    
    .btn-sm:hover {
      background: #ffe0b2;
    }
  </style>
</head>
<body>

  <!-- NOTIFICATION -->
  <div id="notification" class="notification"></div>
  
  <!-- âœ… BARU: SYNC NOTIFICATION BAR -->
  <div id="syncNotification"></div>

  <!-- LOGIN SCREEN -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <div class="logo">ğŸ’§</div>
      <h1 class="login-title">Jasa Tirta Luhur</h1>
      <p class="login-subtitle">Laporan Kualitas Air Baku & Air Bersih</p>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="loginUsername" placeholder="Masukkan username" autocomplete="username">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="loginPassword" placeholder="Masukkan password" autocomplete="current-password">
      </div>
      <button class="btn btn-primary" onclick="login()">ğŸ” Login</button>
      <button id="installBtn" class="btn btn-install" onclick="installPWA()">ğŸ“± Install Aplikasi</button>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="mainApp" class="hidden">
    <!-- HEADER -->
    <div class="header">
      <h1>ğŸ’§ Laporan Kualitas Air</h1>
      <div class="user-info">
        <span id="userDisplay"></span>
        <button onclick="logout()" class="btn-logout">Logout</button>
      </div>
    </div>

    <!-- FORM INPUT -->
    <div id="formScreen" class="container">
      <div class="card">
        <h2 class="section-title">ğŸ“‹ Form Laporan Kualitas</h2>
        
        <!-- DRAFT INDICATOR -->
        <div style="margin-bottom: 15px;">
          <span id="draftIndicator" style="display:none; background:#ff9800; color:white; padding:8px 12px; border-radius:6px; font-size:13px; font-weight:bold;">
            ğŸ“ Draft tersedia
          </span>
        </div>
        
        <!-- âœ… BARU: VALIDATION STATUS -->
        <div id="validationStatus"></div>
        
        <!-- HEADER INFO -->
        <div class="form-section">
          <h3>â„¹ï¸ Informasi Laporan</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Hari <span style="color:red;">*</span></label>
              <input type="text" id="hari" placeholder="Contoh: Senin" required>
            </div>
            <div class="form-group">
              <label>Tanggal <span style="color:red;">*</span></label>
              <input type="date" id="tanggal" required onchange="onDateChange()">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Operator/Petugas <span style="color:red;">*</span></label>
              <input type="text" id="operator" placeholder="Nama petugas laboratorium" required>
            </div>
            <div class="form-group">
              <label>Shift <span style="color:red;">*</span></label>
              <select id="shift" required>
                <option value="">-- Pilih Shift --</option>
                <option value="Shift 1">Shift 1</option>
                <option value="Shift 2">Shift 2</option>
              </select>
            </div>
          </div>
        </div>

        <!-- FREKUENSI PENGAMBILAN -->
        <div class="form-section">
          <h3>â° Frekuensi Pemeriksaan <span style="color:red;">*</span></h3>
          <p style="font-size: 13px; color: #666; margin-bottom: 12px;">Pilih jam pemeriksaan (centang jam yang diperlukan)</p>
          <div class="time-slots">
            <label><input type="checkbox" class="time-check" value="08:00" checked onchange="updateSelectedTimes()"> 08:00</label>
            <label><input type="checkbox" class="time-check" value="09:00" checked onchange="updateSelectedTimes()"> 09:00</label>
            <label><input type="checkbox" class="time-check" value="10:00" checked onchange="updateSelectedTimes()"> 10:00</label>
            <label><input type="checkbox" class="time-check" value="11:00" checked onchange="updateSelectedTimes()"> 11:00</label>
            <label><input type="checkbox" class="time-check" value="12:00" checked onchange="updateSelectedTimes()"> 12:00</label>
            <label><input type="checkbox" class="time-check" value="13:00" checked onchange="updateSelectedTimes()"> 13:00</label>
            <label><input type="checkbox" class="time-check" value="14:00" checked onchange="updateSelectedTimes()"> 14:00</label>
            <label><input type="checkbox" class="time-check" value="15:00" checked onchange="updateSelectedTimes()"> 15:00</label>
            <label><input type="checkbox" class="time-check" value="16:00" checked onchange="updateSelectedTimes()"> 16:00</label>
            <label><input type="checkbox" class="time-check" value="17:00" checked onchange="updateSelectedTimes()"> 17:00</label>
            <label><input type="checkbox" class="time-check" value="18:00" checked onchange="updateSelectedTimes()"> 18:00</label>
            <label><input type="checkbox" class="time-check" value="19:00" checked onchange="updateSelectedTimes()"> 19:00</label>
            <label><input type="checkbox" class="time-check" value="20:00" checked onchange="updateSelectedTimes()"> 20:00</label>
            <label><input type="checkbox" class="time-check" value="21:00" checked onchange="updateSelectedTimes()"> 21:00</label>
            <label><input type="checkbox" class="time-check" value="22:00" checked onchange="updateSelectedTimes()"> 22:00</label>
            <label><input type="checkbox" class="time-check" value="23:00" checked onchange="updateSelectedTimes()"> 23:00</label>
            <label><input type="checkbox" class="time-check" value="00:00" checked onchange="updateSelectedTimes()"> 00:00</label>
            <label><input type="checkbox" class="time-check" value="01:00" checked onchange="updateSelectedTimes()"> 01:00</label>
            <label><input type="checkbox" class="time-check" value="02:00" checked onchange="updateSelectedTimes()"> 02:00</label>
            <label><input type="checkbox" class="time-check" value="03:00" checked onchange="updateSelectedTimes()"> 03:00</label>
            <label><input type="checkbox" class="time-check" value="04:00" checked onchange="updateSelectedTimes()"> 04:00</label>
            <label><input type="checkbox" class="time-check" value="05:00" checked onchange="updateSelectedTimes()"> 05:00</label>
            <label><input type="checkbox" class="time-check" value="06:00" checked onchange="updateSelectedTimes()"> 06:00</label>
            <label><input type="checkbox" class="time-check" value="07:00" checked onchange="updateSelectedTimes()"> 07:00</label>
          </div>
        </div>

        <!-- DATA KUALITAS AIR -->
        <div class="form-section">
          <h3>ğŸ”¬ Data Pemeriksaan Kualitas Air <span style="color:red;">*</span></h3>
          <p style="font-size: 13px; color: #f44336; margin-bottom: 12px;">
            <strong>âš ï¸ Semua field wajib diisi!</strong> Field yang kosong akan ditandai dengan warna merah.
          </p>
          <div class="data-table" id="kualitasAirTable"></div>
        </div>

        <!-- CATATAN -->
        <div class="form-section">
          <h3>ğŸ“ Catatan Tambahan</h3>
          <div class="form-group">
            <label>Catatan (opsional)</label>
            <textarea id="catatan" rows="3" placeholder="Catatan atau keterangan tambahan..."></textarea>
          </div>
        </div>

        <!-- BUTTONS -->
        <div class="form-actions">
          <button class="btn btn-warning" onclick="saveDraft()" id="saveDraftBtn">
            ğŸ’¾ Simpan Draft
          </button>
          
          <button class="btn btn-success" onclick="saveDataFinal()" id="saveFinalBtn">
            ğŸ“¤ Kirim ke Google Drive
          </button>
          
          <button class="btn btn-danger" onclick="deleteDraft()">
            ğŸ—‘ï¸ Hapus Draft
          </button>
          
          <button class="btn btn-secondary" onclick="clearForm()">
            ğŸ”„ Reset Form
          </button>
        </div>
        
        <div style="margin-top: 15px; padding: 12px; background: #e0f2f1; border-radius: 8px; font-size: 13px;">
          <strong>ğŸ’¡ Tips:</strong>
          <ul style="margin: 8px 0 0 20px; line-height: 1.6;">
            <li><strong>Simpan Draft</strong>: Menyimpan data di browser & server (bisa dilanjutkan kapan saja)</li>
            <li><strong>Kirim ke Google Drive</strong>: Mengirim laporan final (semua field harus terisi)</li>
            <li>âœ… Draft otomatis tersimpan setiap 30 detik</li>
            <li>ğŸ”„ Sistem akan memberitahu jika ada user lain yang mengubah data</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- HISTORY SCREEN -->
    <div id="historyScreen" class="container hidden">
      <div class="card">
        <h2 class="section-title">ğŸ“œ Riwayat Laporan</h2>
        <button class="btn btn-primary" onclick="loadHistory()" style="margin-bottom:20px;">
          ğŸ”„ Refresh Data
        </button>
        <div id="historyList"></div>
      </div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <div class="bottom-nav">
      <button class="nav-item active" onclick="switchScreen('form')">
        <div class="nav-icon">â•</div>
        <div class="nav-label">Input Data</div>
      </button>
      <button class="nav-item" onclick="switchScreen('history')">
        <div class="nav-icon">ğŸ“œ</div>
        <div class="nav-label">Riwayat</div>
      </button>
    </div>
  </div>

  <script src="app.js"></script>

</body>
</html>
